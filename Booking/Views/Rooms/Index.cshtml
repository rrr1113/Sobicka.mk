@model IEnumerable<Booking.Models.Room>

@{
    ViewBag.Title = "Index";
}
<div class="proba" style="padding: 40px; border-radius: 30px">
<h2>Соби</h2>

@if (User.IsInRole("Manager"))
{
    <p>
        @Html.ActionLink("Креирај нова соба", "Create", null, null, new { @class = "btn btn-primary" })
    </p>
}
<table class="table table-hover" id="tabela">
    <thead>


        <tr>
            <th>
                @Html.DisplayNameFor(model => model.ImageURL)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Number)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Price)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Capacity)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Hotel.Name) 
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Status)
            </th>
            <th></th>
        </tr>
    </thead>

    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    <img src="@item.ImageURL" style="width: 200px;" />
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Number)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Price)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Capacity)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Hotel.Name) - @item.Hotel.Town.Name
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Status)
                </td>
                <td>

                    @Html.ActionLink("Детали", "Details", new { id = item.Id }, new { @class = "btn btn-outline-primary" })
                    @Html.ActionLink("Резервирај", "Create", "Reservations", new { id = item.Id }, new { @class = "btn btn-primary" })
                    @if (User.IsInRole("Manager") || User.IsInRole("Receptionist"))
                    {
                        @Html.ActionLink("Измени", "Edit", new { id = item.Id }, new { @class = "btn btn-warning" })
                    }
                    @if (User.IsInRole("Manager"))
                    {
                        <button kopce=@item.Id class="btn btn-danger js-delete">Избриши</button>
                    }
                </td>
            </tr>
        }
    </tbody>

</table>
</div>

    @section scripts{
        <script>
            $(document).ready(function () {
                var tabelata = $("#tabela").DataTable();
                $("#tabela .js-delete").on("click", function () {
                    var kopceto = $(this);
                    bootbox.confirm("Дали сакате да ја избришете оваа соба?", function (result) {
                        if (result) {
                            $.ajax({
                                url: "/Rooms/Delete/" + kopceto.attr("kopce"),
                                method: "GET",
                                success: function () {
                                    tabelata.row(kopceto.parents("tr")).remove().draw();

                                },
                                error: function (err) {
                                    console.log(err)
                                }
                            })
                        }
                    })
                })
            });
        </script>
    }
